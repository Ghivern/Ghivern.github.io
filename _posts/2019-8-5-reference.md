---
title: C++引用
layout: post
tags: [ C++ ]
---



引用是与C相比的C++的新的特点，其就是变量的别名，可以通过引用操作变量。

一、引用的基本使用

type& a =  v;

1. 此时，a即为v的引用，也意味着a和v是同一个变量的两个不同名字。

2. 引用其实是指针变量的封装，int &re = v;其等价形式，int* p = &v,引用re就是*p的封装。但是，引用与指针不同的是，引用必须初始化，初始化后即不能再改变其指向，即一经初始化，便一直效忠于一个变量。

二、用作函数的形式参数和返回值

void func(int& para);

1. 在函数内部可以通过使用形式参数，改变传入值的变量的值，即等价于指针的按地址传递参数。

2. 调用函数时赋予形参的变量需要是有名字的变量，即左值；且变量类型必须和引用类型相同。
   若是，如x+3,4这样的值或float,long类型值传入函数形参，则以前的编译器会创建临时变量，编译完成后由编译器删除，此时相当于按值传递，不能改变外部变量。现在的编译器会报错。
   若欲使用引用处理这种形式的函数，可以使用常量引用，const int &,这种形式就相当于按值传递且编译器不会报错。
          
```

void printPara(int& a){
    cout<<"a="<<a<<endl;
    return;
}

int main(){
    printPara(3);
    return 0;
}
//编译器会报错
//invalid initialization of no_const reference of type 'int&' from an rvalue of type 'int'
```

```
void printPara(const int& a){
    cout<<"a="<<a<<endl;
    return;
}

int main(){
    printPara(3);
    return 0;
}
//执行正确，编译器将创建临时变量并为其赋值3，此时a就是临时变量的引用，编译完成后，临时变量会被删除
```

(3)、用作函数返回值

1. 传统的返回值是计算return后的表达式，将结构返回给调用函数。从概念上讲，返回值将被复制到一个临时位置，而调用程序将使用这个值。
而使用引用作为返回值则不存在这种情况。
   
    + `int func(){int a{5};   return a;}
 int a = func()`,此时5将被存储到临时位置，然后将此值赋给a;
    + `int& func(){int a{5},   int &r=a;  return r;} int a = func()`,将直接把r复制到变量a,此时返回引用的函数实际上是被引用变量的别名.
   
2. 函数应该避免返回函数终止时即不存在的内存单元的引用。
    有两种方法解决此问题：

    * 使用作为参数传递进来的引用作为返回值
    * 使用new来分配新的存储空间

                    

