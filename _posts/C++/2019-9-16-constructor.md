---
title: 构造函数
tags: [C++]
---

总结一下C++构造函数的知识


```
//示例类定义
#include <iostream>
using namespace std;
class Test{
	public:
		void show(){
			cout<<a<<endl;
		}
	private:
		int m_value;
};
```

一、构造函数作用及形式

1. 在定义对象时可以直接初始化对象的成员变量

2. 构造函数是和类名相同且没有返回值的函数。可以带参数，也可不带参数（称为默认构造函数）。

3. 若程序员不声明任何构造函数，则编译器会帮助程序员生成默认构造函数，尽管这个构造函数不做任何事情。

4. 若程序员声明了一个构造函数，且不是默认构造函数，则编译器也不会自动生成默认构造函数，此时若使用`Test a;`形式生成对象会出现编译错误，应该有程序员显示声明默认构造函数。

5. 构造函数和普通函数一样，可以重载

```
//改造示例代码，添加构造函数
#include <iostream>
using namespace std;
Class Test{
	public:
		Test(){ a = 0;} //显示声明定义的默认构造函数
		Test(int a_) { a = a_;} //声明定义的带参数的构造函数
		void show() {
			cout<<a<<endl;
		}
	private:
		int a;
};

int main(){
	//隐式调用构造函数
	Test x;  //声明对象时使用默认构造函数，a == 0
	Test y(5); //声明对象时使用带参数的构造函数, a == 5
	//Test z(); //错误的形式，这条语句编译器理解为声明函数

	//显示调用构造函数
	Test j = Test();   //调用默认构造函数，与上面不同，此时括号不能省略
	Test k = Test(4);  //调用带参数的构造函数

	//使用new运算符生成对象时
	Test *p = new Test();  //调用默认构造函数，此时的括号可以省略也可以不省略
	Test *q = new Test(6); //调用带参数的构造函数
}
```

二、构造函数的初始化列表

1. 可将一中的示例代码中在构造函数的函数体中的赋值语句省略，用初始化列表实现

2. 语法格式如示例代码所示,若有多个成员变量，可以在后面加“,“继续初始化其他变量

```
#include <iostream>
using namespace std;
Class Test{
	public:
		Test():a(0),b(0) {}//显示声明定义的默认构造函数
		void show() {
			cout<<a<<endl;
		}
	private:
		int a,b;
};
```


三、拷贝构造函数

1. 作用是使用对象去初始化新建对象，和普通构造函数一样，若程序员未声明，编译器会自动生成

2. 拷贝构造函数名字和类名相同，没有返回值，参数是自身真个类的对象的const引用

3. 在通过一个已经存在的对象去初始化新对象时，拷贝构造函数将会被调用

4. 默认构造函数之只会指向浅拷贝，当需要深拷贝时需要程序员自己实现拷贝构造函数

	* 浅拷贝：只将存在对象的成员变量全部赋值给初始化的对象，哪怕是指针成员变量，也只复制值。将导致两个对象的指针成员变量指向同一块内存单元
	* 深拷贝：对于指针变量，新对象将生成新的内存单元地址，但是将已经存在对象的指针指向的内存块存储的内容复制到新对象的指针指向的内存单元

```
//改造示例代码，添加拷贝构造函数
#include <iostream>
using namespace std;
Class Test{
	public:
		Test(const Test & t){
			a = t.a;
		}
		void show() {
			cout<<a<<endl;
		}
	private:
		int a;
};

int main(){
	Test a(3);
	Test b = a;
	Test c(a);   //上述两种形式在初始化对象时均会调用拷贝构造函数
	Test d;   d = a;  //a赋值给d时不会调用拷贝构造函数，其只会在初始化对象时被调用；这两条语句没有错误，只是执行oprrate=函数，我们可以对其进行重载，赋予其新含义，也可以使用默认含义（简单值的赋值）
}
```